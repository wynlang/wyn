// Comprehensive production test - validates all fixed features
fn main() -> int {
    var failures = 0
    
    print("=== PRODUCTION READINESS TEST ===")
    
    // Test 1: Parse error detection
    var invalid = str_parse_int("not_a_number")
    if !str_parse_int_failed(invalid) {
        print("FAIL: Parse error not detected")
        failures = failures + 1
    } else {
        print("✓ Parse error detection")
    }
    
    // Test 2: Array indexing type safety
    var names: [string] = ["Alice", "Bob", "Charlie"]
    var first_name = names[0]
    var len = str_len(first_name)
    if len != 5 {
        print("FAIL: Array indexing type")
        failures = failures + 1
    } else {
        print("✓ Array indexing type safety")
    }
    
    // Test 3: String concatenation with int_to_str
    var count = 42
    var msg = "Count: " + int_to_str(count)
    if !str_contains(msg, "42") {
        print("FAIL: String concat with int_to_str")
        failures = failures + 1
    } else {
        print("✓ String concat with int_to_str")
    }
    
    // Test 4: File I/O
    var test_file = "/tmp/wyn_production_test.txt"
    file_write(test_file, "Production test content")
    if !file_exists(test_file) {
        print("FAIL: file_exists")
        failures = failures + 1
    } else {
        print("✓ file_exists")
    }
    
    var content = file_read(test_file)
    if !str_contains(content, "Production") {
        print("FAIL: file_read")
        failures = failures + 1
    } else {
        print("✓ file_read")
    }
    
    // Test 5: String functions with concatenation
    var text = "hello"
    var upper = str_upper(text)
    var result = "Upper: " + upper
    if !str_contains(result, "HELLO") {
        print("FAIL: str_upper with concat")
        failures = failures + 1
    } else {
        print("✓ str_upper with concat")
    }
    
    // Test 6: char_at with comparison
    var ch = char_at("test", 0)
    if ch != "t" {
        print("FAIL: char_at")
        failures = failures + 1
    } else {
        print("✓ char_at")
    }
    
    // Test 7: split_get with concatenation
    var part = split_get("a,b,c", ",", 1)
    var split_msg = "Part: " + part
    if !str_contains(split_msg, "b") {
        print("FAIL: split_get")
        failures = failures + 1
    } else {
        print("✓ split_get")
    }
    
    // Test 8: Complex string operations
    var data = "  spaces  "
    var trimmed = str_trim(data)
    var final_msg = "Trimmed: " + trimmed
    if !str_contains(final_msg, "spaces") {
        print("FAIL: str_trim")
        failures = failures + 1
    } else {
        print("✓ str_trim")
    }
    
    // Test 9: Real-world scenario - CSV processing
    var csv_line = "John,25,Engineer"
    var name = split_get(csv_line, ",", 0)
    var age_str = split_get(csv_line, ",", 1)
    var job = split_get(csv_line, ",", 2)
    
    var age = str_parse_int(age_str)
    if str_parse_int_failed(age) {
        print("FAIL: CSV parsing")
        failures = failures + 1
    } else {
        var csv_msg = name + " is " + int_to_str(age) + " years old"
        if !str_contains(csv_msg, "John") {
            print("FAIL: CSV processing")
            failures = failures + 1
        } else {
            print("✓ CSV processing")
        }
    }
    
    // Test 10: File-based CLI tool simulation
    var log_file = "/tmp/wyn_log.txt"
    var log_content = "Line 1\nLine 2\nLine 3"
    file_write(log_file, log_content)
    
    var log_data = file_read(log_file)
    var line_count = 0
    var i = 0
    while i < str_len(log_data) {
        var c = char_at(log_data, i)
        if c == "\n" {
            line_count = line_count + 1
        }
        i = i + 1
    }
    line_count = line_count + 1
    
    if line_count != 3 {
        print("FAIL: Line counting")
        failures = failures + 1
    } else {
        print("✓ Line counting CLI tool")
    }
    
    print("=================================")
    
    if failures == 0 {
        print("✅ ALL PRODUCTION TESTS PASSED")
        print("Wyn is PRODUCTION READY!")
        return 0
    }
    
    print("❌ FAILED: " + int_to_str(failures) + " tests")
    return 1
}
