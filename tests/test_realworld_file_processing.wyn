// Real-World Test: File Processing Pipeline
// Process text data through multiple transformations

fn to_uppercase_words(text: string) -> string {
    return text.upper()
}

fn count_lines(text: string) -> int {
    var count = 1
    var i = 0
    
    while i < text.len() {
        var ch = text.slice(i, i + 1)
        var newline: string = "\n"
        if ch == newline {
            count = count + 1
        }
        i = i + 1
    }
    
    return count
}

fn remove_extra_spaces(text: string) -> string {
    var result: string = ""
    var prev_space = 0
    var i = 0
    
    while i < text.len() {
        var ch = text.slice(i, i + 1)
        var space: string = " "
        
        if ch == space {
            if prev_space == 0 {
                result = result + ch
                prev_space = 1
            }
        } else {
            result = result + ch
            prev_space = 0
        }
        i = i + 1
    }
    
    return result
}

fn test_uppercase_transform() -> int {
    var text: string = "hello world"
    var result = to_uppercase_words(text)
    var expected: string = "HELLO WORLD"
    
    if result == expected {
        print("PASS: uppercase transform\n")
        return 0
    }
    return 1
}

fn test_count_single_line() -> int {
    var text: string = "hello"
    var count = count_lines(text)
    
    if count == 1 {
        print("PASS: count single line\n")
        return 0
    }
    return 1
}

fn test_count_multiple_lines() -> int {
    var text: string = "line1\nline2\nline3"
    var count = count_lines(text)
    
    if count == 3 {
        print("PASS: count multiple lines\n")
        return 0
    }
    return 1
}

fn test_remove_extra_spaces() -> int {
    var text: string = "hello  world  test"
    var result = remove_extra_spaces(text)
    var expected: string = "hello world test"
    
    if result == expected {
        print("PASS: remove extra spaces\n")
        return 0
    }
    return 1
}

fn test_pipeline() -> int {
    var text: string = "hello  world"
    var cleaned = remove_extra_spaces(text)
    var upper = to_uppercase_words(cleaned)
    var expected: string = "HELLO WORLD"
    
    if upper == expected {
        print("PASS: pipeline\n")
        return 0
    }
    return 1
}

fn main() -> int {
    print("=== Real-World: File Processing Pipeline ===\n")
    var failures = 0
    failures = failures + test_uppercase_transform()
    failures = failures + test_count_single_line()
    failures = failures + test_count_multiple_lines()
    failures = failures + test_remove_extra_spaces()
    failures = failures + test_pipeline()
    
    if failures == 0 {
        print("\nAll tests PASSED!\n")
    }
    return failures
}
