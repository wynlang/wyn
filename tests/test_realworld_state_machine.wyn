// Real-World Test: State Machine - Simple order processing

fn process_order_state(state: int, action: int) -> int {
    // States: 0=pending, 1=processing, 2=shipped, 3=delivered, 4=cancelled
    // Actions: 0=process, 1=ship, 2=deliver, 3=cancel
    
    if state == 0 {
        if action == 0 {
            return 1
        }
        if action == 3 {
            return 4
        }
    }
    
    if state == 1 {
        if action == 1 {
            return 2
        }
        if action == 3 {
            return 4
        }
    }
    
    if state == 2 {
        if action == 2 {
            return 3
        }
    }
    
    return state
}

fn test_order_pending_to_processing() -> int {
    var state = 0
    var new_state = process_order_state(state, 0)
    
    if new_state == 1 {
        print("PASS: pending to processing\n")
        return 0
    }
    return 1
}

fn test_order_processing_to_shipped() -> int {
    var state = 1
    var new_state = process_order_state(state, 1)
    
    if new_state == 2 {
        print("PASS: processing to shipped\n")
        return 0
    }
    return 1
}

fn test_order_shipped_to_delivered() -> int {
    var state = 2
    var new_state = process_order_state(state, 2)
    
    if new_state == 3 {
        print("PASS: shipped to delivered\n")
        return 0
    }
    return 1
}

fn test_order_cancel_from_pending() -> int {
    var state = 0
    var new_state = process_order_state(state, 3)
    
    if new_state == 4 {
        print("PASS: cancel from pending\n")
        return 0
    }
    return 1
}

fn test_order_full_workflow() -> int {
    var state = 0
    state = process_order_state(state, 0)
    state = process_order_state(state, 1)
    state = process_order_state(state, 2)
    
    if state == 3 {
        print("PASS: full workflow\n")
        return 0
    }
    return 1
}

fn main() -> int {
    print("=== Real-World: State Machine ===\n")
    var failures = 0
    failures = failures + test_order_pending_to_processing()
    failures = failures + test_order_processing_to_shipped()
    failures = failures + test_order_shipped_to_delivered()
    failures = failures + test_order_cancel_from_pending()
    failures = failures + test_order_full_workflow()
    
    if failures == 0 {
        print("\nAll tests PASSED!\n")
    }
    return failures
}
