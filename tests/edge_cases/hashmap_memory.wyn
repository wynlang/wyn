// Test HashMap for memory leaks by creating/destroying many times
fn main() -> int {
    var iterations = 100;
    var entries_per_map = 50;
    
    print("Testing HashMap memory management with ");
    print(iterations);
    print(" iterations\n");
    
    var i = 0;
    while (i < iterations) {
        var map = wyn_hashmap_new();
        
        // Fill map with entries
        var j = 0;
        while (j < entries_per_map) {
            wyn_hashmap_insert_int(map, "test_key", j * i);
            j = j + 1;
        }
        
        // Verify entry exists
        if (wyn_hashmap_has(map, "test_key")) {
            // Good, entry exists
        } else {
            print("ERROR: Missing entry in iteration ");
            print(i);
            print("\n");
        }
        
        // Test some operations
        wyn_hashmap_insert_int(map, "new_key", 12345);
        
        var len = wyn_hashmap_len(map);
        if (len != 2) {  // Should be 2: test_key and new_key
            print("WARNING: Unexpected length ");
            print(len);
            print(" in iteration ");
            print(i);
            print("\n");
        }
        
        // Free the map
        wyn_hashmap_free(map);
        
        // Progress indicator
        if (i % 10 == 0) {
            print("Completed ");
            print(i);
            print(" iterations\n");
        }
        
        i = i + 1;
    }
    
    print("Memory test completed - ");
    print(iterations);
    print(" maps created and destroyed\n");
    
    // Test rapid creation/destruction
    print("Testing rapid creation/destruction...\n");
    i = 0;
    while (i < 1000) {
        var map = wyn_hashmap_new();
        wyn_hashmap_insert_int(map, "quick", i);
        var val = wyn_hashmap_get_int(map, "quick");
        if (val != i) {
            print("ERROR: Value mismatch in rapid test at ");
            print(i);
            print("\n");
        }
        wyn_hashmap_free(map);
        i = i + 1;
    }
    
    print("Rapid test completed - 1000 quick operations\n");
    
    // Test with multiple keys (more complex memory management)
    print("Testing multiple key memory management...\n");
    i = 0;
    while (i < 50) {
        var map = wyn_hashmap_new();
        
        // Add multiple keys
        wyn_hashmap_insert_int(map, "key1", 1);
        wyn_hashmap_insert_int(map, "key2", 2);
        wyn_hashmap_insert_int(map, "key3", 3);
        wyn_hashmap_insert_int(map, "key4", 4);
        wyn_hashmap_insert_int(map, "key5", 5);
        
        var final_len = wyn_hashmap_len(map);
        if (final_len != 5) {
            print("ERROR: Expected length 5, got ");
            print(final_len);
            print("\n");
        }
        
        wyn_hashmap_free(map);
        i = i + 1;
    }
    
    print("Multiple key memory test completed\n");
    
    // Test edge case: free empty map
    var empty_map = wyn_hashmap_new();
    wyn_hashmap_free(empty_map);
    print("Empty map free test: OK\n");
    
    print("All memory leak tests completed successfully\n");
    return 0;
}