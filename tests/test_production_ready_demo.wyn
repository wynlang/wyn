// Production-Ready Demo: CSV Parser with Error Handling
// Demonstrates both critical fixes working together

fn main() -> int {
    var passed = 0
    var failed = 0
    
    // Test 1: Parse valid CSV row with error handling
    var csv_line = "John,25,Engineer"
    var parts: [string] = ["John", "25", "Engineer"]
    
    // Extract name (array indexing - BLOCKER #2 FIXED)
    var name = parts[0]
    if str_len(name) > 0 {
        passed = passed + 1
    } else {
        failed = failed + 1
    }
    
    // Parse age with error detection (BLOCKER #1 FIXED)
    var age = str_parse_int(parts[1])
    if !str_parse_int_failed(age) {
        if age == 25 {
            passed = passed + 1
        } else {
            failed = failed + 1
        }
    } else {
        failed = failed + 1
    }
    
    // Extract job (array indexing)
    var job = parts[2]
    if str_len(job) > 0 {
        passed = passed + 1
    } else {
        failed = failed + 1
    }
    
    // Test 2: Handle invalid age gracefully
    var invalid_parts: [string] = ["Jane", "invalid", "Doctor"]
    var invalid_age = str_parse_int(invalid_parts[1])
    if str_parse_int_failed(invalid_age) {
        // Error detected correctly!
        passed = passed + 1
    } else {
        failed = failed + 1
    }
    
    // Test 3: Array of numbers with type safety
    var numbers: [int] = [10, 20, 30]
    var first_num = numbers[0]
    if first_num == 10 {
        passed = passed + 1
    } else {
        failed = failed + 1
    }
    
    if failed == 0 {
        print("All tests PASSED")
        print("âœ“ CSV parsing with error handling works!")
        print("âœ“ Array indexing type-safe!")
        return 0
    }
    print("Some tests FAILED")
    return 1
}
