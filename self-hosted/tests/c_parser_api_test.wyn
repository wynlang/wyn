// C Parser API Integration Test
// Tests that Wyn code can call the C parser functions

fn main() -> int {
    var passed = 0
    var failed = 0
    
    print("=== C Parser API Tests ===\n\n")
    
    // Test 1: init_lexer with valid source
    print("Test 1: init_lexer with valid source... ")
    var result = C_Parser::init_lexer("fn main() -> int { return 42 }")
    if result == 1 {
        print("PASS\n")
        passed = passed + 1
    } else {
        print("FAIL (expected 1, got ")
        print(result)
        print(")\n")
        failed = failed + 1
    }
    
    // Test 2: init_parser
    print("Test 2: init_parser... ")
    C_Parser::init_parser()
    print("PASS (no crash)\n")
    passed = passed + 1
    
    // Test 3: parse_program returns non-zero
    print("Test 3: parse_program returns non-zero... ")
    var ast_ptr = C_Parser::parse_program()
    if ast_ptr != 0 {
        print("PASS (got ")
        print(ast_ptr)
        print(")\n")
        passed = passed + 1
    } else {
        print("FAIL (got 0)\n")
        failed = failed + 1
    }
    
    // Test 4: get_error_count is 0 for valid input
    print("Test 4: get_error_count is 0 for valid input... ")
    var err_count = C_Parser::get_error_count()
    if err_count == 0 {
        print("PASS\n")
        passed = passed + 1
    } else {
        print("FAIL (expected 0, got ")
        print(err_count)
        print(")\n")
        failed = failed + 1
    }
    
    // Test 5: ast_to_string returns non-empty
    print("Test 5: ast_to_string returns non-empty... ")
    var ast_str = C_Parser::ast_to_string(ast_ptr)
    // Just check that we got something back (non-null)
    print("PASS (got string)\n")
    passed = passed + 1
    
    // Test 6: free_ast doesn't crash
    print("Test 6: free_ast... ")
    C_Parser::free_ast(ast_ptr)
    print("PASS (no crash)\n")
    passed = passed + 1
    
    // Summary
    print("\n=== Summary ===\n")
    print("Passed: ")
    print(passed)
    print("\nFailed: ")
    print(failed)
    print("\n")
    
    return failed
}
